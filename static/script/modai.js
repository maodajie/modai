/*!
 * @name:modai
 * @author:大橙子
 * @qqcode:1570457334
 * @description:苹果CMS v10 魔袋工具箱
 * @website:http://modai.maodajie.com
 * @telegram:https://t.me/maccms_tools
 * @version:2021.0821.1933
 */layui.config({base:magic.addon+magic.base+"/script/"}).use(["common"],(function(){window.$=window.jQuery=layui.$;var e={global:function(){layui.form.render("select"),e.update.render("update"),layui.form.on("submit(config)",(function(e){return Object.assign(e.field||{},{type:e.elem.dataset.type}),$.post(magic.admin+"/home/save",e.field,(function(e){layer.msg(e.msg,{time:1e3},(function(){location.reload()}))})).error((function(e){layer.msg("请求失败："+e.status)}),"json"),!1})),$(".md-email-wrap").length?e.mailer.render("mailer"):$(".md-union-wrap").length?e.collect.render("collect"):$(".md-login-wrap").length?e.center.render():$(".md-plot-wrap").length?e.ploter.render("ploter"):$(".md-option-wrap").length?e.option.render():$(".md-search-wrap").length&&e.search.render(),layui.form.on("submit(index)",(function(t){magic.entry?e.label("index"+t.elem.dataset.code,t.elem.dataset.title,t.elem.dataset.url):$.get(magic.admin+"/option/entry",(function(a){layer.open({btn:!1,area:"370px",title:"后台入口设置",content:a,success:function(a,n){$(a).find(".layui-layer-content").css("overflow","unset"),layui.form.render("select"),layui.form.on("submit(entry)",(function(a){return $.post(magic.admin+"/option/entry",a.field,(function(a){layer.msg(a.msg,{time:1e3},(function(){1==a.code&&e.label("index"+t.elem.dataset.code,t.elem.dataset.title,t.elem.dataset.url)}))}),"json"),!1}))}})}),"json")})),layui.form.on("submit(save)",(function(e){return $.post(location.href,"save=1",(function(e){layer.closeAll(),layer.msg(e.msg,{time:1e3},(function(){1==e.code&&location.reload()}))})),!1})),layui.form.on("submit(option)",(function(e){return $.post(location.href,data.field,(function(e){layer.closeAll(),layer.msg(e.msg,{time:1e3},(function(){e.code}))})),!1}))},label:function(e,t,a){var n=$(this);return!!a&&(window.top==window.self||"indexissues"==e?(window.open(a,"_blank"),!1):$(window.parent.document).find('iframe[lay-id="'+e+'"]')[0]?($('[lay-id="'+e+'"]',window.parent.document).hasClass("layui-this")?location.href=a:parent.layui.element.tabChange("macTab",e),event.stopPropagation(),!1):(parent.layui.element.tabAdd("macTab",{content:'<iframe width="100%" height="100%" lay-id="'+e+'" frameborder="0" src="'+a+'" scrolling="yes" class="x-iframe"></iframe>',title:t||n.text(),id:e}),void parent.layui.element.tabChange("macTab",e)))},update:{render:function(){$.post(magic.admin+"/home/version",(function(e){var t=["关闭窗口"];1==e.code&&($('[data-code="version"]').find("p").html("最新版："+e.ver+" 立即更新").css("color","red"),t=["立即更新","取消更新"]);var a='<table class="layui-table ts-note-body">';a+="<thead></thead>",a+="<tbody>",$.each(e.log,(function(e,t){a+='<tr><td class="ts-note-nums" width="20" align="center">'+Number(e+1)+'</td><td class="ts-note-item">'+t+"</td></tr>"})),a+="</tbody>",a+="</table>",$(document).on("click",".ts-admin-news",(function(){layer.confirm(a,{area:"auto",maxWidth:"50%",maxHeight:"400",title:"最新版"+e.ver+"更新日志",btn:t,skin:"ts-note-wrap",success:function(){$(".layui-layer-content").css("padding",0)}},(function(t,a){1==e.code?(t=layer.msg("正在升级插件,请稍等",{icon:16,time:0}),$.post(magic.admin+"/home/update","ver="+e.ver,(function(e){layer.close(t),layer.msg(e.msg,{time:1e3},(function(){location.reload()}))})).error((function(e){layer.msg("请求失败："+e.status)}),"json")):layer.close(t)}))}))}))}},search:{image:function(e,t){return 1==t&&/douban|iqiyi/i.test(e)?"https://i"+Math.floor(3*Math.random())+".wp.com/"+e.replace("https://","").replace("http://","").replace("//",""):e},render:function(){layui.form.on("submit(write)",(function(t){var a=$(this),n=$(a).data("module"),l=$('[name="type_id"]',window.parent.document).val(),o=$('[name="'+n+'_id"]',window.parent.document).val(),i=$(a).data("mask"),r=layer.msg("数据加载中",{shade:.3,icon:16,time:0});if("iframe"==$(t.elem).data("type"))return parent.layui.layer.open({type:2,maxmin:!1,offset:"auto",area:["45%","60%"],content:magic.admin+"/"+$(t.elem).data("controller")+"/"+$(t.elem).data("action")+"/id/"+$(t.elem).data("id")+"/start/"+$(t.elem).data("start")+"/tid/"+l+"/rid/"+o+"/name/"+$(t.elem).data("name"),cancel:function(e,t){layer.close(r)}}),parent.layui.layer.photos({photos:".md-image-wrap",anim:5}),!1;$.post(magic.admin+"/"+$(t.elem).data("controller")+"/"+$(t.elem).data("action")+"/id/"+$(t.elem).data("id")+"/start/"+$(t.elem).data("start")+"/tid/"+l+"/rid/"+o+"/name/"+$(t.elem).data("name"),(function(t){layer.close(r),parent.layer.closeAll(),parent.layer.msg(t.msg,{offset:"auto"}),t.data.name&&$('[name="'+n+'_name"]',window.parent.document).val(t.data.name),t.data.sub&&$('[name="'+n+'_sub"],[name="'+n+'_alias"]',window.parent.document).val(t.data.sub),t.data.pic&&"website"!=n&&$('[name="'+n+'_pic"]',window.parent.document).val(e.search.image(t.data.pic,i)),t.data.area&&$('[name="'+n+'_area"]',window.parent.document).val(t.data.area),t.data.category&&$('[name="'+n+'_class"],[name="'+n+'_tag"]',window.parent.document).val(t.data.category),t.data.remarks&&$('[name="'+n+'_remarks"]',window.parent.document).val(t.data.remarks),t.data.blurb&&$('[name="'+n+'_blurb"]',window.parent.document).val(t.data.blurb),t.data.stills&&$('[name="'+n+'_pic_screenshot"]',window.parent.document).val(t.data.stills.join("\n")),t.data.content&&parent.editor_setContent(parent.editor_getEditor(n+"_content"),t.data.content),"vod"==n?(t.data.douban_id&&$('[name="'+n+'_douban_id"]',window.parent.document).val(t.data.douban_id),t.data.douban_score&&$('[name="'+n+'_douban_score"],[name="'+n+'_score"]',window.parent.document).val(t.data.douban_score),t.data.author&&$('[name="'+n+'_author"]',window.parent.document,window.parent.document).val(t.data.author),t.data.actor&&$('[name="'+n+'_actor"]',window.parent.document).val(t.data.actor),t.data.director&&$('[name="'+n+'_director"]',window.parent.document).val(t.data.director),t.data.writer&&$('[name="'+n+'_writer"]',window.parent.document).val(t.data.writer),t.data.tv&&$('[name="'+n+'_tv"]',window.parent.document).val(t.data.tv),t.data.pubdate&&($('[name="'+n+'_pubdate"]',window.parent.document).val(t.data.pubdate),$('[name="'+n+'_year"]',window.parent.document).val(t.data.pubdate.match(/\d{4,}/gi)[0])),t.data.language&&$('[name="'+n+'_lang"]',window.parent.document).val(t.data.language),t.data.total&&$('[name="'+n+'_total"]',window.parent.document).val(t.data.total),t.data.behind&&$('[name="'+n+'_behind"]',window.parent.document).val(t.data.behind),t.data.duration&&$('[name="'+n+'_duration"]',window.parent.document).val(t.data.duration),t.data.tags&&$('[name="'+n+'_tag"]',window.parent.document).val(t.data.tags)):"actor"==n?(t.data.sex&&($('[name="'+n+'_sex"]',window.parent.document).val(t.data.sex),parent.layui.form.render("select")),t.data.height&&$('[name="'+n+'_height"]',window.parent.document).val(t.data.height),t.data.weight&&$('[name="'+n+'_weight"]',window.parent.document).val(t.data.weight),t.data.blood&&$('[name="'+n+'_blood"]',window.parent.document).val(t.data.blood),t.data.birthday&&$('[name="'+n+'_birthday"]',window.parent.document).val(t.data.birthday),t.data.starsign&&$('[name="'+n+'_starsign"]',window.parent.document).val(t.data.starsign),t.data.birtharea&&$('[name="'+n+'_birtharea"]',window.parent.document).val(t.data.birtharea),t.data.school&&$('[name="'+n+'_school"]',window.parent.document).val(t.data.school),t.data.works&&$('[name="'+n+'_works"]',window.parent.document).val(t.data.works)):"website"==n&&(t.data.website&&$('[name="'+n+'_jumpurl"]',window.parent.document).val(t.data.website),t.data.logo&&$('[name="'+n+'_logo"]',window.parent.document).val(t.data.logo))}))}))}},option:{render:function(){layui.form.on("submit(entry)",(function(e){return $.post(magic.admin+"/option/entry",e.field,(function(e){layer.msg(e.msg,{time:1e3})}),"json"),!1})),layui.form.on("submit(money)",(function(e){return $.get(magic.admin+"/option/card",(function(e){layer.open({btn:!1,area:"370px",title:"充值积分联系QQ:1570457334",content:e,success:function(e,t){$(e).find(".layui-layer-content").css("overflow","unset"),layui.form.on("submit(card)",(function(e){return!(!e.field.card_no||!e.field.card_pwd||($.post(magic.admin+"/option/card",e.field,(function(e){layer.msg(e.msg,(function(){location.reload()}))}),"json"),1))})),layui.form.on("submit(price)",(function(e){$.get(magic.admin+"/option/price",(function(e){layer.open({btn:!1,area:"370px",title:"价格",content:e})}))}))}})}),"json"),!1}))}},ploter:{render:function(e){var t=0,a=[];layui.table.init(e,{id:e,method:"post",url:location.href,height:"full",limit:10,limits:[10,20],autoSort:!1,page:!0,response:{statusCode:1},done:function(a,n,l){return 0!=t&&(n>=Math.ceil(l/10)?(layer.alert("采集完毕"),!1):void setTimeout((function(){layui.table.reload(e,{page:{curr:n+1}},!0)}),$('[lay-filter="space"]').val()))}}),layui.table.on("sort("+e+")",(function(n){t=0,a.order=n.field+" "+n.type,a.collect="",layui.table.reload(e,{initSort:n,where:a,page:{curr:1}},!0)})),layui.form.on("select("+e+")",(function(n){t=0,a[n.elem.dataset.field]=n.value,a.collect="",layui.table.reload(e,{where:a,page:{curr:1}},!0)})),layui.form.on("submit(start)",(function(n){t=1,a.collect=1,layui.table.reload(e,{where:a,page:{curr:1}},!0)}))}},mailer:{render:function(e){var t=[];layui.table.init(e,{id:e,method:"post",url:location.href,height:"277",limit:100,limits:[20,50,100,200,500],autoSort:!1,page:!0,response:{statusCode:1}}),layui.table.on("sort("+e+")",(function(a){t.order=a.field+" "+a.type,layui.table.reload(e,{initSort:a,where:t,page:{curr:1}},!0)})),layui.form.on("select("+e+")",(function(a){t[a.elem.dataset.field]=a.value,layui.table.reload(e,{where:t,page:{curr:1}},!0)})),layui.layedit.set({hideTool:["face","image","help"],height:100}),$("textarea").each((function(e,t){layui.layedit.build($(t).attr("id"))})),layui.form.verify({content:function(e,t){if(!layui.layedit.getContent(layui.layedit.index))return"请输入邮件内容";layui.layedit.sync(layui.layedit.index)},mailer:function(e,t){var a=[];if($.each(layui.table.checkStatus("filter").data,(function(e,t){a.push(t.user_email)})),a.length<1)return"请至少选择一个邮箱账号";$(t).val(a)}}),layui.form.on("select(theme)",(function(e){$(e.elem).parents(".md-email-table").find('[name="nick"]').val($(".md-theme-table").eq(e.value).find('[name="nick[]"]').val()),$(e.elem).parents(".md-email-table").find('[name="title"]').val($(".md-theme-table").eq(e.value).find('[name="title[]"]').val()),$(e.elem).parents(".md-email-table").find('[name="content"]').html($(".md-theme-table").eq(e.value).find('[name="content[]"]').val()),layui.layedit.build("content")})),layui.form.on("submit(submit)",(function(e){var t=layer.load(2);return $.post(magic.admin+"/mailer/send",e.field,(function(e){layer.close(t),layer.msg(e.msg,{time:1e3},(function(){1!=e.code&&location.reload()}))})).error((function(e){layer.msg("请求失败："+e.status)}),"json"),!1})),$(document).on("click",'[lay-filter="test"]',(function(){var e=layer.load(2),t=$(this).parents("table");$.post(magic.admin+"/mailer/test",{host:t.find('[name="host[]"]').val(),port:t.find('[name="port[]"]').val(),secure:t.find('[name="secure[]"]').val(),username:t.find('[name="username[]"]').val(),password:t.find('[name="password[]"]').val(),test:t.find('[name="test[]"]').val()},(function(t){layer.close(e),layer.msg(t.msg)}),"json")})).on("click",'[lay-event="search"]',(function(){t.wd=$('[type="search"]').val(),layui.table.reload(e,{where:t,page:{curr:1}},!0)})).on("click",'[lay-filter="adding"]',(function(){var e="content"+$(".md-theme-table").length;$(this).parents("table").after($(this).parents("table").prop("outerHTML")).next().hide().fadeIn().find("input").val(""),$(this).parents("table").next().find("textarea").attr("id",e).html(""),layui.layedit.build(e),layui.form.render("select")})).on("click",'[lay-filter="delete"]',(function(){if($(".md-addon-form").find(".layui-table").length<2)return layer.msg("请至少保留一个",{icon:5,anim:6}),!1;$(this).parents("table").remove(),layui.form.render("select")}))}},collect:{table1:[{type:"checkbox"},{field:"collect_id",title:"ID",width:60,sort:!0},{field:"collect_mid_text",title:"类型",width:58},{field:"collect_type_text",title:"接口类型",width:86,hide:!0},{field:"collect_name",title:"名称",event:"open",style:"cursor:pointer;",sort:!0},{field:"collect_url",title:"采集地址",hide:!0},{toolbar:"#open",title:"操作",width:266},{toolbar:"#edit",title:"编辑",width:116}],table2:[{field:"collect_id",title:"ID",width:60,hide:!0},{toolbar:"#search",title:"操作",width:66},{field:"collect_mid_text",title:"类型",width:60,hide:!0},{field:"collect_bind",title:"绑定分类",event:"bind",style:"cursor:pointer",width:150},{field:"collect_from",title:"播放器",event:"set",style:"cursor:pointer",width:110},{field:"union_name",title:"名称",minWidth:200},{field:"collect_name",title:"资源站",minWidth:200},{field:"union_time",title:"时间",width:160,hide:!0}],stopit:function(e){return'<a lay-submit lay-filter="stopit" class="layui-btn layui-btn-sm layui-btn-primary">'+e+"</a>"},search:function(t,a,n,l,o,i){if(i>=n.length)return $(".layui-table-tool-temp").html(e.collect.stopit("搜索完毕")+'&nbsp;&nbsp;&nbsp;<span style="color:red">共搜索到'+l.length+"条数据</span>"),!1;var r=10,d=setInterval((function(){r>0?($(".layui-table-time").html("&nbsp;("+r+")"),r--):clearInterval(d)}),1e3);n[i].wd=$('input[type="search"]').val(),$.ajaxSettings.timeout=1e4;var c=$.post(magic.admin+"/collect/search",n[i],(function(e,n){e.data.length>0&&$.each(e.data,(function(e,t){l.push(t)})),layui.table.reload(t,{cols:[a],data:l,url:!1,text:{none:"搜索中,请稍等"},page:{curr:1}})})).complete((function(r,c){clearInterval(d),i+1<n.length&&$(".layui-table-tool-temp").html(e.collect.stopit("停止搜索")+'&nbsp;&nbsp;&nbsp;<span style="color:red">正在搜索:'+n[i+1].collect_name+'<span class="layui-table-time"></span></span>'),1==o?e.collect.search(t,a,n,l,o,i+1):$(".layui-table-tool-temp").html(e.collect.stopit("已停止")+'&nbsp;&nbsp;&nbsp;<span style="color:red">已停止搜索</span>')}),"json");layui.form.on("submit(stopit)",(function(e){clearInterval(d),o=0,c.abort()}))},render:function(t){var a=[],n="";layui.table.render({elem:"#"+t,method:"post",toolbar:"#toolbar",url:location.href,height:"full-100",limit:50,limits:[20,50,100],cols:[e.collect.table1],autoSort:!1,page:!0,response:{statusCode:1},defaultToolbar:["filter",{title:"刷新",layEvent:"reload",icon:"layui-icon-refresh"}]}),layui.table.on("sort("+t+")",(function(n){a.order=n.field+" "+n.type,layui.table.reload(t,{url:location.href,cols:[e.collect.table1],initSort:n,where:a,page:{curr:1},text:{none:"暂无相关数据"}},!0)})),layui.form.on("select("+t+")",(function(n){a[n.elem.dataset.field]=n.value,layui.table.reload(t,{url:location.href,cols:[e.collect.table1],where:a,page:{curr:1},text:{none:"暂无相关数据"}},!0)})),layui.form.on("submit(search)",(function(a){$('[type="checkbox"]').length&&(n=layui.table.checkStatus(t).data).length<1&&(n=layui.table.getData(t)),layui.table.reload(t,{cols:[e.collect.table2],data:[],url:!1,text:{none:"搜索中,请稍等"},page:{curr:1}}),$(".layui-table-tool-temp").html(e.collect.stopit("停止搜索")+'&nbsp;&nbsp;&nbsp;<span style="color:red">正在搜索:'+n[0].collect_name+'<span class="layui-table-time"></span></span>'),e.collect.search(t,e.collect.table2,n,[],1,0)})),layui.table.on("toolbar("+t+")",(function(a){"add"==a.event?layer.open({area:["85%","80%"],title:"添加自定义资源",content:magic.entry+"/admin/collect/info",maxmin:!0,type:2}):"player"==a.event?layer.open({area:["85%","80%"],title:"添加播放器",content:magic.entry+"/admin/vodplayer/info",maxmin:!0,type:2}):"break"==a.event?e.label($(this).data("id"),$(this).data("title"),$(this).data("url")):"reload"==a.event&&layui.table.reload(t,{url:location.href,cols:[e.collect.table1],text:{none:"暂无相关数据"}},!0)})),layui.table.on("tool("+t+")",(function(a){var n=$(this);if("collect"==a.event){if("rgb(255, 0, 0)"!=n.parents("td").siblings('[lay-event="bind"]').find("span").css("color"))return layer.alert("请先绑定分类再采集"),!1;if("rgb(255, 0, 0)"!=n.parents("td").siblings('[lay-event="set"]').find("span").css("color"))return layer.alert("请先添加播放器再采集"),!1;var l=layer.load(2);$.post(a.data.collect_select,(function(e){layer.close(l);var t=e.match(/<font.*>(.*)<\/font>/i);layer.alert(a.data.union_name+"["+a.data.union_remarks+"]"+t[0],{title:a.data.collect_name})}))}else if("open"==a.event)e.label(a.data.collect_flag+"open",a.data.collect_name,a.data.collect_open);else if("day"==a.event)e.label(a.data.collect_flag+"day",a.data.collect_name,a.data.collect_day);else if("week"==a.event)e.label(a.data.collect_flag+"week",a.data.collect_name,a.data.collect_week);else if("all"==a.event)e.label(a.data.collect_flag+"all",a.data.collect_name,a.data.collect_all);else if("time"==a.event)layer.open({area:["85%","80%"],title:"定时任务设置",content:magic.admin+"/collect/timming/id/"+a.data.collect_flag,maxmin:!0,type:2,success:function(e,t){var n=window[e.find("iframe")[0].name].layui,l=n.form.val("config");n.form.val("config",{status:l.name?l.status:1,name:l.name||a.data.collect_flag,param:l.param||a.data.collect_param,des:"每日定时采集："+a.data.collect_name});var o=layer.getChildFrame("body",t);o.find(".layui-word-aux").find("span").html(a.data.collect_flag),o.find('[name="weeks[]"]').is(":checked")||o.find('[name="weeks[]"]').each((function(e,t){t.checked=!0})),o.find('[name="hours[]"]').is(":checked")||o.find('[name="hours[]"]').each((function(e,t){t.checked=!0})),n.form.render("checkbox"),n.form.on("submit(config)",(function(e){return $.post(magic.entry+"/admin/timming/info/id/"+a.data.collect_flag,e.field,(function(e){layer.msg(e.msg,{time:1e3},(function(){1==e.code&&layer.closeAll()}))})),!1}))}});else if("bind"==a.event){var o=a.data.collect_bind_tid;"rgb(255, 0, 0)"!=n.find("span").css("color")&&(o=""),$.post(magic.admin+"/collect/type",{col:a.data.collect_bind_key,val:o,mid:a.data.collect_mid},(function(e){layer.open({btn:!1,area:"300px",title:"绑定分类",content:e,success:function(e,t){$(e).find(".layui-layer-content").css("overflow","unset"),layui.form.render("select"),layui.form.on("submit(bind)",(function(e){return $.post(magic.entry+"/admin/collect/bind",e.field,(function(e){e.data.local_type_name?n.find("span").html("["+e.data.local_type_name+"]").css("color","red"):n.find("span").html("[绑定]").css("color",""),layer.close(t),layer.msg(e.msg)})),!1}))}})}),"json")}else if("set"==a.event){if(1!=a.data.collect_mid)return layer.alert(a.data.collect_mid_text+"不需要配置播放器"),!1;l=layer.load(2),$.ajaxSettings.timeout=1e4;var i=$.post(magic.admin+"/collect/from","url="+a.data.collect_url,(function(e){layer.close(l);var t=e.data;if(a.data.union_play_from)t=a.data.union_play_from.split(",");else if(1!=e.code)return layer.alert(e.msg),!1;var o="";$.each(t,(function(e,t){o+="<div><a "+(e>0?'style="margin-top:10px"':"")+' lay-submit lay-filter="button" class="layui-btn layui-btn-fluid layui-btn-primary" data-from="'+t+'" data-sort="'+layui.common.union.render(a.data.collect_name,t).sort+'">'+layui.common.union.render(a.data.collect_name,t).name+"["+t+"]</a></div>"})),layer.open({btn:!1,area:"360px",title:"添加播放器",content:o,success:function(){layui.form.on("submit(button)",(function(e){layer.open({area:["85%","80%"],title:a.data.collect_name,content:magic.admin+"/collect/"+a.data.collect_mold+"/id/"+e.elem.dataset.from,maxmin:!0,type:2,success:function(t,l){var o=layui.common.union.render(a.data.collect_name,e.elem.dataset.from),i=window[t.find("iframe")[0].name].layui,r=i.form.val("config");i.form.val("config",{status:r.from?r.status:1,from:r.from||e.elem.dataset.from,sort:r.sort||o.sort,show:r.show||o.name,tip:r.tip||o.tips,des:r.des||a.data.collect_url}),i.form.on("submit(config)",(function(t){return $.post(magic.entry+"/admin/vod"+a.data.collect_mold+"/info/id/"+e.elem.dataset.from,t.field,(function(e){1==e.code&&n.find("span").html("["+o.name+"]").css("color","red"),layer.closeAll(),layer.msg(e.msg)})),!1}))}})}))}})})).complete((function(e){layer.close(l),"timeout"==e.statusText&&(layer.alert("请求超时,请重试"),i.abort())})).error((function(e){layer.close(l),layer.msg("请求失败："+e.status)}),"json")}else"edit"==a.event?layer.open({area:["85%","80%"],title:a.data.collect_name,content:magic.entry+"/admin/collect/info/id/"+a.data.collect_id,maxmin:!0,type:2}):"del"==a.event&&layer.confirm("删除之后无法恢复，您确定要删除吗",{title:"提示"},(function(e){$.post(magic.entry+"/admin/collect/del/ids/"+a.data.collect_id,(function(e){layer.msg(e.msg,{time:500,anim:0},(function(){layui.table.reload(t,{},!0)}))}))}))}))}},center:{render:function(){layui.form.on("submit(submit)",(function(e){var t=layer.load(2);$.post(location.href,e.field,(function(a){layer.close(t),layer.msg(a.msg,{time:2e3},(function(){if(1!=a.code)return!1;e.elem.dataset.jump?location.href=e.elem.dataset.jump:location.reload()}))}),"json")})),layui.form.on("submit(verify)",(function(e){$('input[name="code"]').val("").focus();var t=layer.load(2);$.post(e.elem.dataset.url,e.field,(function(a){if(layer.close(t),layer.msg(a.msg),1==a.code)var n=60,l=setInterval((function(){n>0?($(e.elem).addClass("layui-disabled").text("重新获取("+n+")"),n--):($(e.elem).removeClass("layui-disabled").text("获取验证码"),clearInterval(l))}),1e3)}),"json")}))}}};e.global()}));